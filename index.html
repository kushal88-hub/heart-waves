<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Octave Animation in JS</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.js"></script>
<style>
  body { margin: 0; display: flex; flex-direction: column; align-items: center; background: white; }
  canvas { border: 1px solid black; }
  h2 { margin: 10px; }
</style>
</head>
<body>

<h2 id="title">Animation</h2>
<audio id="song" controls>
  <source src="song.mp3" type="audio/mpeg">
  Your browser does not support the audio element.
</audio>

<script>
let x = [];
let numPoints = 400;
let stage = 1;
let i = 0;
let A = 0.3;
let k_values = [];
let k_index = 0;

let stage5_running = false;

function setup() {
  createCanvas(600, 600);
  for (let j = 0; j < numPoints; j++) {
    x.push(map(j, 0, numPoints-1, -2, 2));
  }
  frameRate(60);
  document.getElementById('song').play();
  
  // prepare stage 5 k values
  for (let repeat = 0; repeat < 10; repeat++) {
    k_values = k_values.concat([...Array(200).keys()].map(n => n*0.5)); // linspace 0-100
    k_values = k_values.concat([...Array(200).keys()].map(n => 100 - n*0.5)); // linspace 100-0
  }
}

function draw() {
  background(255);
  strokeWeight(2);
  
  if (stage === 1) {
    document.getElementById('title').innerText = 'y = x^2';
    let y = x.map(v => v*v);
    stroke('blue');
    noFill();
    beginShape();
    for (let j = 0; j <= i; j++) {
      let px = map(x[j], -2, 2, 50, width-50);
      let py = map(y[j], -2, 2, height-50, 50);
      vertex(px, py);
    }
    endShape();
    i++;
    if (i >= numPoints) { i = 0; stage++; }

  } else if (stage === 2) {
    document.getElementById('title').innerText = 'y = Â± x^2';
    let y = x.map(v => v*v);
    stroke('blue');
    noFill();
    beginShape();
    for (let j = 0; j <= i; j++) {
      let px = map(x[j], -2, 2, 50, width-50);
      let py = map(y[j], -2, 2, height-50, 50);
      vertex(px, py);
    }
    endShape();
    beginShape();
    for (let j = 0; j <= i; j++) {
      let px = map(x[j], -2, 2, 50, width-50);
      let py = map(-y[j], -2, 2, height-50, 50);
      vertex(px, py);
    }
    endShape();
    i++;
    if (i >= numPoints) { i = 0; stage++; }

  } else if (stage === 3) {
    document.getElementById('title').innerText = 'y = |x|^{2/3}';
    let y = x.map(v => Math.pow(Math.abs(v), 2/3));
    stroke('blue');
    noFill();
    beginShape();
    for (let j = 0; j <= i; j++) {
      let px = map(x[j], -2, 2, 50, width-50);
      let py = map(y[j], -2, 2, height-50, 50);
      vertex(px, py);
    }
    endShape();
    i++;
    if (i >= numPoints) { i = 0; stage++; }

  } else if (stage === 4) {
    document.getElementById('title').innerText = `y = |x|^{2/3} + ${A} sin(3x)`;
    let k = 3;
    let y = x.map(v => Math.pow(Math.abs(v), 2/3) + A*Math.sin(k*v));
    stroke('blue');
    noFill();
    beginShape();
    for (let j = 0; j <= i; j++) {
      let px = map(x[j], -2, 2, 50, width-50);
      let py = map(y[j], -2, 2, height-50, 50);
      vertex(px, py);
    }
    endShape();
    i++;
    if (i >= numPoints) { i = 0; stage++; stage5_running = true; }

  } else if (stage === 5 && stage5_running) {
    document.getElementById('title').innerText = `Oscillating Love: k = ${k_values[k_index].toFixed(1)}`;
    let y = x.map(v => Math.pow(Math.abs(v), 2/3) + 2*A*Math.sin(k_values[k_index]*v) * Math.sqrt(Math.max(0, 3 - v*v)));
    stroke('red');
    noFill();
    beginShape();
    for (let j = 0; j < numPoints; j++) {
      let px = map(x[j], -2, 2, 50, width-50);
      let py = map(y[j], -2, 2, height-50, 50);
      vertex(px, py);
    }
    endShape();
    k_index++;
    if (k_index >= k_values.length) { stage5_running = false; noLoop(); } // stop animation at end
  }
}
</script>

</body>
</html>

